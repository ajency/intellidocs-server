/*81d496fa291a0d0b087d223f7014c018052e359e*/var fileSystemRoot;var root_file_path;var IntelliDocs={};var global_remove_folders=[];var global_removed_folder_count=0;var global_folder_removed=false;var global_delete_files_list=[];var _prev_record=null;var global_is_user_logged_in=false;var global_long_press=false;var global_root_view=true;var global_goto_node=0;var global_init_launch=true;var global_app_version="Version: 1.0.3";var global_https="https://www.intellidocs.net";document.addEventListener("deviceready",function(){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,IntelliDocs.fileSystemSuccessCallbck,IntelliDocs.fileSystemFailCallbck);if(navigator.onLine){var request=new XMLHttpRequest();request.open("GET",global_https+"/wp-content/plugins/aj-file-manager-system/includes/ajax_folder_deactivated.php",true);request.onreadystatechange=function(){if(request.readyState==4&&request.status==200){var res_data=eval("("+request.responseText+")");global_remove_folders=res_data.data;if(global_remove_folders.length>0){IntelliDocs.remove_directory(global_remove_folders[0].folder)}}};request.send()}document.addEventListener("backbutton",function(e){e.preventDefault();if(global_root_view){Ext.Msg.confirm("","Are you sure you want to exit?",function(buttonId){if(buttonId=="yes"){navigator.app.exitApp()}})}else{Ext.getCmp("dmt-nested-list").goToNode(global_goto_node.parentNode);if(Ext.getCmp("dmt-details-view-card")){Ext.getCmp("dmt-details-view-card").destroy()}Ext.getCmp("dmt-details-container-titlebar").setTitle("");if(global_goto_node.parentNode==null||global_goto_node.parentNode=="undefined"){global_root_view=true;Ext.Msg.confirm("","Are you sure you want to exit?",function(buttonId){if(buttonId=="yes"){navigator.app.exitApp()}})}else{global_goto_node=global_goto_node.parentNode}}},false)},false);IntelliDocs.dmtDetailsPanelChange=function(i,l,f){var m=(f)?"Open":"Download File";var d=(f)?"dmtDetailsPanelOpenButton":"dmtDetailsPanelDownloadButton";var g={};if(!l){var c=i.getData()}else{var c=l}var k=(c.f_ext)?c.f_ext.replace(".",""):"";var j=Ext.getCmp("dmt-details-container");var h=Ext.getCmp("dmt-details-container-titlebar");var n=(c.f_description=="")?"":'<p class="dmt-file-meta-data"><span class="dmt-file-meta-data-field-label">Description: </span>'+c.f_description+"</p>";var e=(c.f_solicitor=="")?"":'<p class="dmt-file-meta-data"><span class="dmt-file-meta-data-field-label">Solicitor: </span>'+c.f_solicitor+"</p>";var p=(c.f_item_id==null)?"":'<p class="dmt-file-meta-data"><span class="dmt-file-meta-data-field-label">Item Id: </span>'+c.f_item_id+"</p>";switch(c.f_type){case"file":g={id:"dmt-details-view-card",cls:"dmtDetailsViewPanel",scrollable:true,layout:{type:"vbox",pack:"center",align:"left",},items:[{styleHtmlContent:true,html:['<div class="dmt-file-icon-big dmt-file-icon-desc dmt-file-'+k+'-large"></div><div class="dmt-file-meta-desc"><p class="dmt-file-meta-data"><span class="dmt-file-meta-data-field-label">Name:</span>'+c.f_name+'</p><p class="dmt-file-meta-data"><span class="dmt-file-meta-data-field-label">Type:</span>'+c.f_ext+"</p>"+e+p+n+"</div>"],items:[{xtype:"hiddenfield",name:"document_url",id:"dmtFileUrl",value:c.f_attachment},{xtype:"hiddenfield",name:"document_folder",id:"dmtFileFolder",value:c.f_folder},{xtype:"hiddenfield",name:"document_folder_id",id:"dmtFileFolder_id",value:c.f_id},]},{style:"margin-left:65px;margin-top:20px;",xtype:"button",id:"dmt-file-action-button",text:m,cls:"dmt-details-panel-download-button",ui:"confirm round",iconCls:"download",iconMask:true,iconAlign:"right",width:150,height:32,action:d,}]};if(f){g.items.push({style:"margin-left:65px;margin-top:20px;",xtype:"button",text:"Delete File",cls:"dmt-details-panel-download-button",ui:"round",iconCls:"delete",iconMask:true,iconAlign:"right",width:150,height:32,action:"dmtDetailsPanelDeleteButton",})}break;case"folder":g={layout:{type:"vbox",pack:"center",align:"center",},id:"dmt-details-view-card",cls:"dmtDetailsViewPanel",scrollable:true,styleHtmlContent:true,items:[{html:'<div class="dmt-file-icon-big dmt-file-'+k+'-large"></div>'},{html:'<p class="dmt-file-meta-data"><span class="dmt-file-meta-data-field-label">Name:</span>'+c.f_name+"</p>"},{xtype:"hiddenfield",name:"document_folder_id",id:"dmtFileFolderId",value:c.f_id,},{xtype:"hiddenfield",name:"document_folder_path",id:"dmtFileFolderPath",value:c.f_folder,},{xtype:"hiddenfield",name:"document_folder_count",id:"dmtFileFolder_count",value:c.f_file_count,},{html:"<p></p>",id:"dmt-folder-metadata"},]};if(c.f_file_count>0){g.items.push({xtype:"button",text:"Download all files in folder",cls:"dmt-details-panel-folder-download-button",ui:"confirm round",iconCls:"download",iconMask:true,iconAlign:"right",width:250,height:32,style:"margin-top:20px",action:"dmtDetailsPanelFolderDownloadButton",})}var o=c.f_sub_fld_count;if(o>0){g.items.push({xtype:"button",text:"Download Files In Sub Folder",cls:"dmt-details-panel-folder-download-button",ui:"confirm round",iconCls:"download",iconMask:true,iconAlign:"right",width:250,height:32,style:"margin-top:20px",action:"dmtDetailsPanelSubFolderDownloadButton",})}if(c.f_file_count>0){g.items.push({xtype:"button",text:"Delete Files In Folder",cls:"dmt-details-panel-folder-download-button",ui:"round",iconCls:"delete",iconMask:true,iconAlign:"right",width:250,height:32,style:"margin-top:20px",action:"dmtDetailsPanelFolderDeleteFilesButton",})}IntelliDocs.getFolderMeta(c.f_folder,c.f_file_count);break;default:g=null}if(Ext.getCmp("dmt-details-view-card")){Ext.getCmp("dmt-details-view-card").destroy()}if(g){var a=Ext.create("Ext.Panel",g);var b=(c.f_name)?c.f_name+" details":"Details Panel";h.setTitle(b);j.add([a]).show({type:"pop",duration:500,easing:"ease-out"})}else{h.setTitle("Details Panel")}};IntelliDocs.intellidocs_session_timeout=function(b){Ext.Msg.alert("Session Expired","Your session on the server has expired.Please login in again.");IntelliDocs.dmtSecureLoginLogout();var d=Ext.getCmp("dmt-main-container");if(Ext.getCmp("dmt-secure-login-panel")){Ext.getCmp("dmt-secure-login-panel").destroy()}var c=Ext.create("DMTApp.view.DmtSecureLogin");d.setActiveItem(c);var a=Ext.direct.Manager.getProvider("dmt-notification-polling");a.disconnect()};IntelliDocs.dmtSecureLoginLogout=function(){var c=Ext.getStore("DmtLocalStorageCookie");c.load();var b=c.find("key","dmtScLgInfo");if(b==-1){var a=Ext.create("DMTApp.model.DmtLocalStorageCookieModel",{key:"dmtScLgInfo",value:"loggedOutSuccessfully",user_name:""});a.save()}else{var a=c.getAt(b);a.set("value","loggedOutSuccessfully");a.set("user_name","");a.save()}};IntelliDocs.dmtGetUsernameFromCache=function(){var d=Ext.getStore("DmtLocalStorageCookie");d.load();var c=d.find("key","dmtScLgInfo");if(c==-1){console.log("nothing found");return""}else{var b=d.getAt(c);var a=b.getData();console.log("uname:"+a.user_name);return a.user_name}};IntelliDocs.fileSystemFailCallbck=function(a){console.log("error:"+a)};IntelliDocs.fileSystemSuccessCallbck=function(a){fileSystemRoot=a.root;console.log("Got the file system root object");root_file_path=a.root.fullPath;console.log("Got the full path to root directory",root_file_path);fileSystemRoot.getDirectory("intellidocs",{create:true,exclusive:false},function(b){},function(b){console.log(b.code+"Folder exists.")});root_file_path+="/intellidocs";root_file_path=root_file_path.substr(7)};IntelliDocs.write_json=function(is_not_offline,user_name){var ajax=new XMLHttpRequest();ajax.open("GET",global_https+"/wp-content/plugins/aj-file-manager-system/includes/ajax_request.php?user_name="+user_name,true);ajax.send();ajax.onreadystatechange=function(){if(ajax.readyState==4){if(ajax.status==200){var data_to_write=ajax.responseText;var session_data=eval(data_to_write);if(!session_data.session){IntelliDocs.intellidocs_session_timeout()}else{fileSystemRoot.getFile(root_file_path+"/dir_list.js",{create:true},function(fileEntry){fileEntry.createWriter(function(fileWriter){fileWriter.onwrite=function(e){console.log("JS file Write completed.");DMTApp.launched=false;if(global_init_launch){global_init_launch=false}if(is_not_offline){Ext.getStore("DmtFolderStructureStore").load();Ext.getStore("DmtFolderStructureStore").dmtRemoveNotificationsFromServer();Ext.getCmp("dmt-nested-list").unmask()}};fileWriter.write(data_to_write)},function(e){console.log("Error"+e.code)})},function(e){console.log("Error"+e.code)})}}else{Ext.getCmp("dmt-nested-list").unmask();Ext.Msg.alert("","Failed to read data from server. Please try again")}}}};IntelliDocs.remove_directory=function(a){var b=root_file_path+"/"+a;fileSystemRoot.getDirectory(b,{},function(c){c.removeRecursively(function(d){console.log("Remove Recursively Succeeded");global_folder_removed=true;global_removed_folder_count++;if(global_removed_folder_count==global_remove_folders.length){global_folder_removed=false;global_remove_folders=[];global_removed_folder_count=0}else{if(global_removed_folder_count<global_remove_folders.length){IntelliDocs.remove_directory(global_remove_folders[global_removed_folder_count].folder)}}},function(d){console.log("Failed to remove direcoty and files"+d.code);global_folder_removed=true;global_removed_folder_count++;if(global_removed_folder_count==global_remove_folders.length){global_folder_removed=false;global_remove_folders=[];global_removed_folder_count=0}else{if(global_removed_folder_count<global_remove_folders.length){IntelliDocs.remove_directory(global_remove_folders[global_removed_folder_count].folder)}}})},function(c){console.log("Directory doesn't exists: Skipp"+c.code);global_removed_folder_count++;if(global_removed_folder_count==global_remove_folders.length){global_folder_removed=false;global_remove_folders=[];global_removed_folder_count=0}else{if(global_removed_folder_count<global_remove_folders.length){IntelliDocs.remove_directory(global_remove_folders[global_removed_folder_count].folder)}}})};var global_queued_file_urls=[];var global_queued_file_download_complete_count=0;var global_current_download_folder_id=0;var global_download_file_count=0;IntelliDocs.download_queued_file=function(b){var a=b.path;var c=b.url;c=c.substring(c.lastIndexOf("/")+1);fileSystemRoot.getFile(root_file_path+"/"+a+"/"+c,{},function(d){console.log("File present. Skip");global_queued_file_download_complete_count++;if(global_queued_file_download_complete_count==global_queued_file_urls.length){console.log("All files downloaded");Ext.getCmp("dmt-download-progress-folder").destroy();if(global_download_file_count==0){Ext.Msg.alert("","All files have already been downloaded",Ext.emptyFn)}else{var e=global_download_file_count==1?global_download_file_count+" file":global_download_file_count+" files";Ext.Msg.alert("",e+" successfully downloaded",Ext.emptyFn)}global_queued_file_urls=[];global_queued_file_download_complete_count=0;global_current_download_folder_id=0;global_download_file_count=0;IntelliDocs.getFolderMeta(Ext.getCmp("dmtFileFolderPath")._value,Ext.getCmp("dmtFileFolder_count")._value)}else{IntelliDocs.download_queued_file(global_queued_file_urls[global_queued_file_download_complete_count])}},function(e){console.log("doesn't exists"+e.code);var d="("+(global_queued_file_download_complete_count+1)+"/"+global_queued_file_urls.length+")";Ext.getCmp("dmt-dolder-file-name").setHtml(c);document.getElementById("dmt-folder-file-percentage").innerHTML="0%";window.plugins.downloader.downloadFile(b.url,{dirName:root_file_path+"/"+a,overwrite:false},function(f){var h=Math.round(f.progress);document.getElementById("dmt-folder-file-percentage").innerHTML=h+"%";if(f.status==1){console.log("File Downloaded");global_queued_file_download_complete_count++;global_download_file_count++;if(global_queued_file_download_complete_count==global_queued_file_urls.length){console.log("All files downloaded");if(global_download_file_count==0){Ext.Msg.alert("","All files have already been downloaded",Ext.emptyFn)}else{var g=global_download_file_count==1?global_download_file_count+" file":global_download_file_count+" files";Ext.Msg.alert("",g+" successfully downloaded",Ext.emptyFn)}global_queued_file_urls=[];global_queued_file_download_complete_count=0;global_current_download_folder_id=0;global_download_file_count=0;Ext.getCmp("dmt-download-progress-folder").destroy()}else{IntelliDocs.download_queued_file(global_queued_file_urls[global_queued_file_download_complete_count])}IntelliDocs.getFolderMeta(Ext.getCmp("dmtFileFolderPath")._value,Ext.getCmp("dmtFileFolder_count")._value)}},function(f){console.log("Download failed:");Ext.getCmp("dmt-download-progress-folder").destroy();if(global_download_file_count>0){var g=global_download_file_count==1?global_download_file_count+" file":global_download_file_count+" files";Ext.Msg.alert("",g+" successfully downloaded",Ext.emptyFn)}else{Ext.Msg.alert("Download Failed!","Please try again!")}global_queued_file_urls=[];global_queued_file_download_complete_count=0;global_current_download_folder_id=0;global_download_file_count=0;IntelliDocs.getFolderMeta(Ext.getCmp("dmtFileFolderPath")._value,Ext.getCmp("dmtFileFolder_count")._value)})})};IntelliDocs.loop_json=function(a,e,d){for(var c in a){if(a.hasOwnProperty(c)){if(c=="items"){var g=a[c];if(g.length>0){for(var b=0;b<g.length;b++){var f=g[b];if(f.f_id==e&&f.f_type=="folder"){console.log(f.f_name+" Found the folder element");global_current_download_folder_id=e;IntelliDocs.dmtCreateDirectories(f.f_folder);IntelliDocs.get_all_leaf_elements(f.items,d);break}else{IntelliDocs.loop_json(f,e,d)}}}}}}};IntelliDocs.recursive_looping=function(c){for(var a=0;a<c.length;a++){var b=c[a];if(b.leaf&&(b.f_type=="file")){global_queued_file_urls.push({url:b.f_attachment,path:b.f_folder})}else{if(b.f_type=="folder"){IntelliDocs.recursive_looping(b.items)}}}};IntelliDocs.get_all_leaf_elements=function(d,b){if(b){IntelliDocs.recursive_looping(d)}else{for(var a=0;a<d.length;a++){var c=d[a];if(c.leaf&&(c.f_type=="file")){console.log("File found");global_queued_file_urls.push({url:c.f_attachment,path:c.f_folder})}else{if(c.f_type=="folder"&&b){console.log("Dir found");IntelliDocs.dmtCreateDirectories(c.f_folder);IntelliDocs.get_all_leaf_elements(c.items,true)}}}}if(global_queued_file_urls.length>0){console.log("Files count"+global_queued_file_urls.length);IntelliDocs.download_queued_file(global_queued_file_urls[0])}else{Ext.getCmp("dmt-download-progress-folder").destroy();global_queued_file_urls=[];global_queued_file_download_complete_count=0;global_current_download_folder_id=0}};IntelliDocs.getFolderMeta=function(b,d){var f="";var a=0;var e=0;var c=0;fileSystemRoot.getDirectory(root_file_path+"/"+b,{},function(h){var g=h.createReader();g.readEntries(function(j){for(var k=0;k<j.length;k++){if(j[k].isFile&&j[k].name!=".DS_Store"){a++}}e=(d==a)?0:(d-a);f="Total Files: "+d+"/ Downloaded Files: "+a+"/ Remaining Files: "+e;Ext.getCmp("dmt-folder-metadata").setHtml(f)},function(i){})},function(g){console.log("Failed to load files details");f="Total Files: "+d+"/ Downloaded Files: 0 / Remaining Files: "+d;Ext.getCmp("dmt-folder-metadata").setHtml(f)})};IntelliDocs.dmtCreateDirectories=function(c){var b=c.split("/");for(var e=0;e<b.length;e++){var a="";for(var d=0;d<=e;d++){a+=b[d]+"/"}fileSystemRoot.getDirectory(a,{create:true,exclusive:false},function(f){console.log("Dir created")},function(f){console.log(f.code+"Folder exists. Lets check next")})}};IntelliDocs.downloadFile=function(b){if(navigator.onLine){var d=b.getData().f_attachment;var e=d.substring(d.lastIndexOf("/")+1);var c={id:"dmt-download-progress",minWidth:300,minHeight:200,hideOnMaskTap:false,modal:true,centered:true,layout:{type:"vbox",pack:"center",align:"center",},items:[{xtype:"titlebar",docked:"top",title:"Download"},{xtype:"panel",html:e,},{xtype:"panel",html:'<div id="loading-container"><div id="loading-box"><div id="loading-bar"><div id="percentage"></div></div></div></div>',}]};Ext.Viewport.add(Ext.create("Ext.Panel",c)).show({type:"pop",duration:250,easing:"ease-out"});var a=b.getData().f_folder;IntelliDocs.dmtCreateDirectories(a);window.plugins.downloader.downloadFile(d,{dirName:root_file_path+"/"+a,overwrite:false},function(f){var g=Math.round(f.progress);document.getElementById("percentage").innerHTML=g+"%";if(f.status==1){console.log("File Downloaded");Ext.getCmp("dmt-download-progress").destroy();Ext.getCmp("dmt-file-action-button").setText("Open");window.plugins.FileOpenPlugin.openFile(root_file_path+"/"+a+"/"+e)}},function(f){console.log("Download failed:"+f);if(f==404){}else{Ext.getCmp("dmt-download-progress").destroy();Ext.Msg.alert("Download Failed!","Please try again!")}})}else{Ext.Msg.alert("Offline","You are currently offline")}};